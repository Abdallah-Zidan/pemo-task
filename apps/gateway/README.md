# Gateway Service

The Gateway Service is the public-facing API layer of the PEMO payment processing system. It handles incoming webhook requests from payment processors and provides query endpoints for transaction data.

## ğŸ¯ Purpose

- **Webhook Processing**: Receive and validate webhooks from multiple payment processors
- **API Gateway**: Provide RESTful endpoints for transaction queries
- **Request Routing**: Route validated requests to the Transaction Service via gRPC
- **Security Layer**: Implement webhook signature verification and request validation

## ğŸ—ï¸ Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Payment       â”‚    â”‚   Payment       â”‚    â”‚   Payment       â”‚
â”‚   Processor 1   â”‚    â”‚   Processor 2   â”‚    â”‚   Processor N   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                      â”‚                      â”‚
          â”‚ HTTP Webhooks        â”‚ HTTP Webhooks        â”‚ HTTP Webhooks
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    Gateway Service      â”‚
                    â”‚                         â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
                    â”‚  â”‚ Controllers     â”‚    â”‚
                    â”‚  â”‚ - Webhook       â”‚    â”‚
                    â”‚  â”‚ - Query         â”‚    â”‚
                    â”‚  â”‚ - Health        â”‚    â”‚
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
                    â”‚                         â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
                    â”‚  â”‚ Services        â”‚    â”‚
                    â”‚  â”‚ - Gateway       â”‚    â”‚
                    â”‚  â”‚ - Validation    â”‚    â”‚
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
                    â”‚                         â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
                    â”‚  â”‚ Adapters        â”‚    â”‚
                    â”‚  â”‚ - Processor One â”‚    â”‚
                    â”‚  â”‚ - Processor Two â”‚    â”‚
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚ gRPC
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Transaction Service    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ Features

### Webhook Processing
- **Multi-Processor Support**: Handle webhooks from unlimited payment processors
- **Signature Verification**: Secure webhook authentication using HMAC signatures
- **Schema Validation**: Validate incoming payloads against processor-specific schemas
- **Async Processing**: Queue transactions for background processing

### Transaction Queries
- **RESTful API**: Standard HTTP endpoints for transaction retrieval
- **Filtering**: Support for card ID, processor ID, and status filtering
- **Pagination**: Efficient pagination for large transaction datasets
- **Response Formatting**: Consistent JSON response formats

### Security & Validation
- **Request Validation**: Comprehensive input validation using DTOs
- **Error Handling**: Standardized error responses with detailed messages
- **Rate Limiting**: Protection against abuse and overload

## ğŸ“ Project Structure

```
src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ gateway/
â”‚   â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”‚   â”œâ”€â”€ gateway.controller.ts       # Main webhook and query endpoints
â”‚   â”‚   â”‚   â”œâ”€â”€ health.controller.ts        # Health check endpoints
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”œâ”€â”€ gateway.service.ts          # Core gateway business logic
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ dtos/
â”‚   â”‚   â”‚   â”œâ”€â”€ request/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ get-transactions.query.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â”‚   â””â”€â”€ response/
â”‚   â”‚   â”‚       â”œâ”€â”€ get-transaction.response.dto.ts
â”‚   â”‚   â”‚       â”œâ”€â”€ pagination-meta.dto.ts
â”‚   â”‚   â”‚       â”œâ”€â”€ transaction-details.response.dto.ts
â”‚   â”‚   â”‚       â””â”€â”€ index.ts
â”‚   â”‚   â””â”€â”€ gateway.module.ts
â”‚   â”œâ”€â”€ transactions/
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”œâ”€â”€ transactions-processing.service.ts  # gRPC client
â”‚   â”‚   â”‚   â”œâ”€â”€ transactions-query.service.ts       # Query service
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ constants/
â”‚   â”‚   â”‚   â”œâ”€â”€ grpc-client.constants.ts
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â””â”€â”€ transactions.module.ts
â”‚   â””â”€â”€ app.module.ts
â”œâ”€â”€ main.ts
â””â”€â”€ assets/
```
